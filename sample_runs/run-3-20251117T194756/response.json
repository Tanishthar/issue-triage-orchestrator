{
  "final_state": {
    "repo_url": "https://github.com/n8n-io/n8n",
    "issue_text": "Repo: https://github.com/n8n-io/n8n | \n  Issue : 'rootStore.restUrl always returns /rest ? WebSockets fail with invalid URL' |\n  README: https://github.com/n8n-io/n8n/blob/master/README.md ",
    "readme_file_path": "https://github.com/n8n-io/n8n/blob/master/README.md",
    "model": null,
    "severity": "high",
    "repro_steps": [
      "Clone the n8n repository and install its dependencies (`npm install`).",
      "Start the application in development mode (`npm run dev` or `npm run start`).",
      "Open the n8n UI in a browser (default http://localhost:5678).",
      "Open the browser’s developer console and evaluate `rootStore.restUrl`.",
      "Observe that the value returned is simply `\"/rest\"` instead of a full URL (e.g., `http://localhost:5678/rest`)."
    ],
    "proposed_fix": null,
    "pr_url": "dry://pr/8540b615",
    "status": "completed"
  },
  "readme_result": {
    "fetched": true,
    "from_cache": true,
    "len": 10000,
    "source": "provided_url"
  },
  "executor_check": {
    "ok": true,
    "message": "Syntax OK"
  },
  "metrics": {
    "generated_at": "2025-11-17T14:18:37.115025",
    "steps_count": 130,
    "unique_steps": 10,
    "error_count": 0,
    "tool_error_rate": 0.0,
    "avg_errors_per_step": 0.0,
    "eval_score": 100
  },
  "pr_result": {
    "pr_id": "8540b615",
    "pr_path": "packages/tools/_dry_prs/pr_8540b615",
    "pr_url": "dry://pr/8540b615",
    "meta": {
      "pr_id": "8540b615",
      "title": "[Triage] proposed fix - Repo: https://github.com/n8n-io/n8n | \n  Issue : 'rootStore.",
      "body": "Automated triage: proposed fix sketch\\n\\nRoot cause: In the frontend store (src/stores/rootStore.ts or similar) the `restUrl` getter simply returns the constant string `'/rest'` or builds the URL from a configuration value that is undefined in development mode. This results in `rootStore.restUrl` being a relative path instead of an absolute URL (e.g., `http://localhost:5678/rest`). WebSocket connections that rely on this value therefore construct an invalid URL and fail.\n\nProposed fix: Update the `restUrl` getter to always return a fully‑qualified URL. The logic should be:\n1. If an explicit `REST_URL` (or similar env/config variable) is provided, use it.\n2. Otherwise, build the URL from the current page origin (`window.location.origin`) and append `/rest`.\n3. Ensure the value is cached or recomputed only when the origin changes (unlikely).\n\nImplementation sketch (TypeScript):\n```ts\nimport { defineStore } from 'pinia';\n\nexport const useRootStore = defineStore('root', {\n  state: () => ({\n    // other state …\n  }),\n  getters: {\n    restUrl: (state) => {\n      // Prefer an explicit config, fall back to the window origin.\n      const configured = (window as any).process?.env?.N8N_REST_URL;\n      if (configured) {\n        return configured.replace(/\\/+$/, '') + '/rest';\n      }\n      // In the browser we can safely use location.origin.\n      if (typeof window !== 'undefined' && window.location) {\n        return `${window.location.origin.replace(/\\/+$/, '')}/rest`;\n      }\n      // As a last resort return the relative path (kept for backward compatibility).\n      return '/rest';\n    },\n  },\n});\n```\nThis change guarantees that `rootStore.restUrl` resolves to a full URL in both development and production, fixing the WebSocket connection errors.\n\nAfter the change, add a unit test (or e2e test) that verifies the getter returns the expected absolute URL when the app is served from `http://localhost:5678`.\\n\\nRepro steps:\\n- Clone the n8n repository and install its dependencies (`npm install`).\\n- Start the application in development mode (`npm run dev` or `npm run start`).\\n- Open the n8n UI in a browser (default http://localhost:5678).\\n- Open the browser’s developer console and evaluate `rootStore.restUrl`.\\n- Observe that the value returned is simply `\"/rest\"` instead of a full URL (e.g., `http://localhost:5678/rest`).",
      "branch": "triage/proposed-fix-high-n8n",
      "created_at": "2025-11-17T14:18:37.097822",
      "file_count": 1
    }
  },
  "message": "Run completed with LLM agent.",
  "llm_mode": "real"
}
