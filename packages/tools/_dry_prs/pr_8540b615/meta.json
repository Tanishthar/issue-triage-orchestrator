{
  "pr_id": "8540b615",
  "title": "[Triage] proposed fix - Repo: https://github.com/n8n-io/n8n | \n  Issue : 'rootStore.",
  "body": "Automated triage: proposed fix sketch\\n\\nRoot cause: In the frontend store (src/stores/rootStore.ts or similar) the `restUrl` getter simply returns the constant string `'/rest'` or builds the URL from a configuration value that is undefined in development mode. This results in `rootStore.restUrl` being a relative path instead of an absolute URL (e.g., `http://localhost:5678/rest`). WebSocket connections that rely on this value therefore construct an invalid URL and fail.\n\nProposed fix: Update the `restUrl` getter to always return a fully\u2011qualified URL. The logic should be:\n1. If an explicit `REST_URL` (or similar env/config variable) is provided, use it.\n2. Otherwise, build the URL from the current page origin (`window.location.origin`) and append `/rest`.\n3. Ensure the value is cached or recomputed only when the origin changes (unlikely).\n\nImplementation sketch (TypeScript):\n```ts\nimport { defineStore } from 'pinia';\n\nexport const useRootStore = defineStore('root', {\n  state: () => ({\n    // other state \u2026\n  }),\n  getters: {\n    restUrl: (state) => {\n      // Prefer an explicit config, fall back to the window origin.\n      const configured = (window as any).process?.env?.N8N_REST_URL;\n      if (configured) {\n        return configured.replace(/\\/+$/, '') + '/rest';\n      }\n      // In the browser we can safely use location.origin.\n      if (typeof window !== 'undefined' && window.location) {\n        return `${window.location.origin.replace(/\\/+$/, '')}/rest`;\n      }\n      // As a last resort return the relative path (kept for backward compatibility).\n      return '/rest';\n    },\n  },\n});\n```\nThis change guarantees that `rootStore.restUrl` resolves to a full URL in both development and production, fixing the WebSocket connection errors.\n\nAfter the change, add a unit test (or e2e test) that verifies the getter returns the expected absolute URL when the app is served from `http://localhost:5678`.\\n\\nRepro steps:\\n- Clone the\u202fn8n\u202frepository and install its dependencies (`npm install`).\\n- Start the application in development mode (`npm run dev` or `npm run start`).\\n- Open the n8n UI in a browser (default\u202fhttp://localhost:5678).\\n- Open the browser\u2019s developer console and evaluate `rootStore.restUrl`.\\n- Observe that the value returned is simply `\"/rest\"` instead of a full URL (e.g., `http://localhost:5678/rest`).",
  "branch": "triage/proposed-fix-high-n8n",
  "created_at": "2025-11-17T14:18:37.097822",
  "file_count": 1
}